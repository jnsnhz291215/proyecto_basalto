<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Informe de Turno</title>
  <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="informe.css">
    <script src="auth_guard.js"></script>
    <script src="navbar.js"></script>
</head>
<body>
  <div id="shared-menu-placeholder"></div>
  <script>
    fetch('menu.html').then(r => r.text()).then(html => {
      const wrapper = document.createElement('div');
      wrapper.innerHTML = html;
      document.body.insertBefore(wrapper, document.body.firstChild);
      // Inicializar menú (toggle y activo)
      const btn = wrapper.querySelector('#nav-toggle');
      const items = wrapper.querySelector('#nav-items');
      if (btn && items) btn.addEventListener('click', () => items.classList.toggle('show'));
            try{ const links = wrapper.querySelectorAll('.nav-item a'); links.forEach(a=>{ if (location.pathname.endsWith(a.getAttribute('href'))) a.classList.add('active'); }); }catch(e){}
                // Menu hamburguesa en móvil: toggle nav-items y nav-right
                if (btn && items) {
                    btn.addEventListener('click', () => {
                        items.classList.toggle('show');
                        const navRight = wrapper.querySelector('#usuario-container');
                        if (navRight) navRight.classList.toggle('show');
                    });
                    const navLinks = items.querySelectorAll('a');
                    navLinks.forEach(link => {
                        link.addEventListener('click', () => {
                            items.classList.remove('show');
                            const navRight = wrapper.querySelector('#usuario-container');
                            if (navRight) navRight.classList.remove('show');
                        });
                    });
                }
                // init user dropdown + session visibility
            try {
                const userToggle = wrapper.querySelector('.user-toggle');
                const userMenu = wrapper.querySelector('.user-menu');
                if (userToggle && userMenu) {
                    userToggle.addEventListener('click', (ev) => { ev.stopPropagation(); userMenu.classList.toggle('show'); userToggle.setAttribute('aria-expanded', userMenu.classList.contains('show')); });
                    document.addEventListener('click', (ev) => { if (!userMenu.contains(ev.target) && !userToggle.contains(ev.target)) { userMenu.classList.remove('show'); userToggle.setAttribute('aria-expanded', 'false'); } });
                }
                const logoutBtn = wrapper.querySelector('.user-menu .danger');
                if (logoutBtn) logoutBtn.addEventListener('click', (ev) => { ev.preventDefault(); localStorage.removeItem('usuarioActivo'); window.location.href = '/index.html'; });
                try {
                    const s = localStorage.getItem('usuarioActivo');
                    if (s) {
                        const u = JSON.parse(s);
                        const nameEl = wrapper.querySelector('.user-name'); if (nameEl && u && u.nombre) nameEl.textContent = u.nombre;
                    }
                } catch(e){}
                        } catch(e){}
            try { if (window.actualizarInterfaz) window.actualizarInterfaz(); } catch(e){}
    }).catch(err => console.error('No se pudo cargar el menú:', err));
  </script>

  <main>
    <div class="informe-container">
        
        <!-- HEADER: Información General -->
        <div class="card-section header-section">
            <div class="input-group">
                <label>Fecha</label>
                <input type="date" id="input-fecha" value="2026-02-05" class="modern-input">
            </div>
            <div class="input-group">
                <label>Turno (Grupo)</label>
                <select id="input-turno" class="modern-input"><option>A</option><option>B</option><option>C</option><option>D</option></select>
            </div>
            <div class="input-group">
                <label>Horómetro Inicial</label>
                <input type="number" id="input-horometro-inicial" placeholder="Ej: 1500.5" class="modern-input">
            </div>
            <div class="input-group">
                <label>Horómetro Final</label>
                <input type="number" id="input-horometro-final" placeholder="Ej: 1512.0" class="modern-input">
            </div>
        </div>

        <!-- TABS NAVIGATION -->
        <div class="tabs-header">
            <button class="tab-btn active" onclick="abrirPestaña(event, 'tab-antecedentes')">
                <i class="fa-solid fa-file-lines"></i> Antecedentes
            </button>
            <button class="tab-btn" onclick="abrirPestaña(event, 'tab-operacion')">
                <i class="fa-solid fa-gears"></i> Operación
            </button>
            <button class="tab-btn" onclick="abrirPestaña(event, 'tab-materiales')">
                <i class="fa-solid fa-boxes"></i> Materiales
            </button>
            <button class="tab-btn" onclick="abrirPestaña(event, 'tab-cierre')">
                <i class="fa-solid fa-square-check"></i> Cierre
            </button>
        </div>

        <!-- TAB 1: ANTECEDENTES -->
        <div id="tab-antecedentes" class="tab-content active">
            <div class="grid-2-col">
                <div class="card-section">
                    <h3 class="section-title">Antecedentes de Faena</h3>
                    <div class="form-grid">
                        <div class="input-group full-width">
                            <label>Faena / C. Costo</label>
                            <input type="text" id="input-faena" placeholder="Ej: Centinela" class="modern-input">
                        </div>
                        <div class="input-group">
                            <label>Equipo</label>
                            <input type="text" id="input-equipo" placeholder="Ej: ED-1200" class="modern-input">
                        </div>
                        <div class="input-group">
                            <label>Operador</label>
                            <input type="text" id="input-operador" value="Juan Sanhueza" readonly class="modern-input input-readonly">
                        </div>
                    </div>
                </div>

                <div class="card-section">
                    <h3 class="section-title">Antecedentes del Pozo</h3>
                    <div class="form-grid">
                        <div class="input-group">
                            <label>Pozo N°</label>
                            <input type="text" id="input-pozo-num" class="modern-input">
                        </div>
                        <div class="input-group">
                            <label>Sector</label>
                            <input type="text" id="input-sector" class="modern-input">
                        </div>
                        <div class="input-group">
                            <label>Inclinación</label>
                            <input type="text" id="input-inclinacion" placeholder="Ej: 90°" class="modern-input">
                        </div>
                        <div class="input-group">
                            <label>Prof. Final</label>
                            <input type="text" id="input-profundidad" class="modern-input">
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-section">
                <h3 class="section-title">Parámetros</h3>
                <div class="form-grid">
                    <div class="input-group">
                        <label>Pull Down (Lbs)</label>
                        <input type="number" id="input-pulldown" placeholder="Ej: 15000" class="modern-input">
                    </div>
                    <div class="input-group">
                        <label>RPM</label>
                        <input type="number" id="input-rpm" placeholder="Ej: 85" class="modern-input">
                    </div>
                </div>
            </div>

            <div class="card-section">
                <h3 class="section-title">Insumos</h3>
                <div class="form-grid">
                    <div class="input-group">
                        <label>Petróleo (Gal)</label>
                        <input type="number" id="input-petroleo" placeholder="Ej: 150" class="modern-input">
                    </div>
                    <div class="input-group">
                        <label>Lubricantes (Ltr)</label>
                        <input type="number" id="input-lubricantes" placeholder="Ej: 50" class="modern-input">
                    </div>
                    <div class="input-group">
                        <label>Aceites (Ltr)</label>
                        <input type="number" id="input-aceites" placeholder="Ej: 30" class="modern-input">
                    </div>
                    <div class="input-group">
                        <label>Otros (Kg)</label>
                        <input type="number" id="input-otros" placeholder="Ej: 100" class="modern-input">
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: OPERACIÓN -->
        <div id="tab-operacion" class="tab-content">
            <div class="card-section">
                <h3 class="section-title">Perforación</h3>
                <div class="table-responsive">
                    <table class="activity-table">
                        <thead>
                            <tr>
                                <th style="width: 100px;">Desde (m)</th>
                                <th style="width: 100px;">Hasta (m)</th>
                                <th style="width: 100px;">Mts. Perf</th>
                                <th style="width: 100px;">Recuper. %</th>
                                <th style="width: 120px;">Tipo Roca</th>
                                <th style="width: 100px;">Dureza</th>
                                <th style="width: 50px;"></th>
                            </tr>
                        </thead>
                        <tbody id="tabla-perforacion">
                        </tbody>
                    </table>
                </div>
                <button class="btn-add-row" id="btnAgregarPerforacion">
                    <i class="fa-solid fa-plus"></i> Agregar registro de perforación
                </button>
            </div>

            <div class="card-section">
                <h3 class="section-title">Descripción Actividades Realizadas</h3>
                <div class="table-responsive">
                    <table class="activity-table">
                        <thead>
                            <tr>
                                <th style="width: 130px; padding: 10px;">Desde</th>
                                <th style="width: 130px; padding: 10px;">Hasta</th>
                                <th style="padding: 10px;">Detalle de Actividad</th>
                                <th style="width: 50px;"></th>
                            </tr>
                        </thead>
                        <tbody id="lista-actividades">
                        </tbody>
                    </table>
                </div>
                <button class="btn-add-row" id="btnAgregar">
                    <i class="fa-solid fa-plus"></i> Agregar otra actividad
                </button>
            </div>
        </div>

        <!-- TAB 3: MATERIALES -->
        <div id="tab-materiales" class="tab-content">
            <div class="materiales-grid">
                <div class="card-section">
                    <h3 class="section-title">Aceros de Perforación</h3>
                    <div class="table-responsive">
                        <table class="activity-table">
                            <thead>
                                <tr>
                                    <th style="width: 100px;">Tipo</th>
                                    <th style="width: 80px;">Cantidad</th>
                                    <th style="width: 50px;"></th>
                                </tr>
                            </thead>
                            <tbody id="tabla-aceros">
                            </tbody>
                        </table>
                    </div>
                    <button class="btn-add-row-small" onclick="agregarFila('tabla-aceros', ['select-acero-tipo', 'input-acero-cant'])">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>

                <div class="card-section">
                    <h3 class="section-title">Rebaje de Htas</h3>
                    <div class="table-responsive">
                        <table class="activity-table">
                            <thead>
                                <tr>
                                    <th style="width: 100px;">Descripción</th>
                                    <th style="width: 80px;">Cantidad</th>
                                    <th style="width: 50px;"></th>
                                </tr>
                            </thead>
                            <tbody id="tabla-rebaje">
                            </tbody>
                        </table>
                    </div>
                    <button class="btn-add-row-small" onclick="agregarFila('tabla-rebaje')">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>

                <div class="card-section">
                    <h3 class="section-title">Accesorios</h3>
                    <div class="table-responsive">
                        <table class="activity-table">
                            <thead>
                                <tr>
                                    <th style="width: 100px;">Descripción</th>
                                    <th style="width: 80px;">Cantidad</th>
                                    <th style="width: 50px;"></th>
                                </tr>
                            </thead>
                            <tbody id="tabla-accesorios">
                            </tbody>
                        </table>
                    </div>
                    <button class="btn-add-row-small" onclick="agregarFila('tabla-accesorios')">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>

                <div class="card-section">
                    <h3 class="section-title">Casing</h3>
                    <div class="table-responsive">
                        <table class="activity-table">
                            <thead>
                                <tr>
                                    <th style="width: 80px;">Diámetro</th>
                                    <th style="width: 80px;">Metros</th>
                                    <th style="width: 50px;"></th>
                                </tr>
                            </thead>
                            <tbody id="tabla-casing">
                            </tbody>
                        </table>
                    </div>
                    <button class="btn-add-row-small" onclick="agregarFila('tabla-casing')">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>

                <div class="card-section">
                    <h3 class="section-title">Aditivos</h3>
                    <div class="table-responsive">
                        <table class="activity-table">
                            <thead>
                                <tr>
                                    <th style="width: 100px;">Tipo</th>
                                    <th style="width: 80px;">Cantidad</th>
                                    <th style="width: 50px;"></th>
                                </tr>
                            </thead>
                            <tbody id="tabla-aditivos">
                            </tbody>
                        </table>
                    </div>
                    <button class="btn-add-row-small" onclick="agregarFila('tabla-aditivos')">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- TAB 4: CIERRE -->
        <div id="tab-cierre" class="tab-content">
            <div class="card-section">
                <h3 class="section-title">Notas / Observaciones</h3>
                <textarea id="notas-observaciones" class="modern-input textarea-large" placeholder="Ingresa cualquier nota, observación o comentario importante sobre el turno..."></textarea>
            </div>
        </div>

        <!-- BOTONES DE ACCIÓN FINALES -->
        <div class="action-bar">
            <button id="btn-guardar-borrador" class="btn btn-secondary-outline" type="button">
                <i class="fa-solid fa-floppy-disk"></i> Guardar Borrador
            </button>
            <button id="btn-finalizar-turno" class="btn btn-success" type="button">
                <i class="fa-solid fa-lock"></i> Finalizar y Bloquear Turno
            </button>
        </div>

    </div>
  </main>
  <script src="informe.js"></script>
</body>
</html>
